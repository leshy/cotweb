{"version":3,"file":"cotwebsocket.cjs.development.js","sources":["../src/index.ts"],"sourcesContent":["//@ts-ignore\nimport { appCore, configSystem } from 'lsh-foundation'\nimport * as path from 'path'\nimport express from \"express\";\nimport { createServer } from \"http\";\nimport engine from 'engine.io';\n//@ts-ignore\nconst createError = require('http-errors');\n\nconst root = path.join(__dirname, '../')\n\ntype Config = configSystem.AppConfig & {\n  apiKey: string\n}\n\nexport const init = async () => {\n  const { logger, config } = await appCore.init<Config>({\n    name: 'cot-websocket',\n    configDir: path.join(root, 'config'),\n    verbose: true,\n    defaultConfig: {}\n  })\n\n  const app = express();\n  const httpServer = createServer(app);\n\n\n  app.set('views', path.join(config.rootDir, 'web/views'));\n  app.set('view engine', 'ejs');\n\n  app.use(express.json());\n  app.use(express.urlencoded({ extended: false }));\n  app.use(express.static(path.join(config.rootDir, 'web/static')));\n\n  app.get('/', function(req, res, next) {\n    res.render('index', { title: 'Express' });\n  });\n\n  // catch 404 and forward to error handler\n  app.use(function(req, res, next) {\n    next(createError(404));\n  });\n\n  //@ts-ignore\n  app.use(function(err, req, res, next) {\n    // set locals, only providing error in development\n    res.locals.message = err.message;\n    console.log(config)\n    //@ts-ignore\n    res.locals.error = config.env === configSystem.Env.dev ? err : {};\n    // render the error page\n    res.status(err.status || 500);\n    res.render('error');\n  });\n\n\n  app.get('/', (req, res) => {\n    res.send('Hello World!')\n  })\n\n  const sockets = engine.attach(httpServer, {})\n  // @ts-ignore\n  sockets.on('connection', (socket) => {\n    console.log('connected')\n    socket.send('hello')\n    // @ts-ignore\n    socket.on('message', (data) => {\n      console.log(data)\n      // @ts-ignore\n      socket.on('close', () => { });\n    })\n  })\n\n  httpServer.listen(3001)\n\n\n\n}\n\ninit()\n"],"names":["createError","require","root","path","join","__dirname","init","logger","config","appCore","name","configDir","verbose","defaultConfig","app","express","httpServer","createServer","set","rootDir","use","json","urlencoded","extended","static","get","req","res","next","render","title","err","locals","message","console","log","error","env","configSystem","Env","dev","status","send","sockets","engine","attach","on","socket","data","listen"],"mappings":"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"}